#!/bin/bash 
if [[ $(command -v h) == '' ]]; then [[ $- != *i* ]] && return; if [[ $(command -v a) == '' && $(grep 'cd;source a' .profile) == '' ]]; then echo 'cd;source a' >> .profile; echo 'cd;source a' >> .bashrc; fi; if [[ $(x=($(echo $BASH_SOURCE|sed 's/\// /g'));echo ${x[-1]}) != 'a' ]]; then mv $BASH_SOURCE a; fi; if [[ $(which sudo) == '' ]]; then alias sudo=''; fi; if [ -e /j ]; then export PS1='\[$(tput bold)\]\[$(tput setaf 1)\]\u@\h:\w\$\[$(tput sgr0)\] '; else export PS1='\u@\h:\w\$ '; fi; 
echo -e '\n'set\ {nu,ai} '\n'nmap\ {f\ gt,F\ gT,I\ gg,O\ G,m\ z.,K\ \<C-B\>,J\ \<C-F\>,r\ \<C-R\>,\,\ \:\%s\/\/\/gc,qq\ \:qa\<CR\>,0\ \^,\;\ \:set\ nu\!\<CR\>,noai\ \:set\ noai\<CR\>} '\n'{i,n}map\ \<F{8,9,10}\>\ \<ESC\>\:w!\<CR\>>~/.vimrc; 
fi; export TERM=xterm; alias a='alias'; [ -f ax ] && . ax 2>/dev/null; 
a ll='ls -al'; a llt='ll -tr'; a lld='ll -d'; a py='python3'; a d='diff -s'; a s='source'; a pip='pip3'; a ..='cd ..'; a dd='date "+DATE: %Y-%m-%d%nTIME: %H:%M:%S"'; a cc='clear'; a chkport='nc -z -v -w5'; a jtree='tree -ahfniF --du --dirsfirst -o .tree'; a jcmp='cmp -l'; a _a='sudo apt-get -y'; a japtu='_a update;_a upgrade;_a dist-upgrade;_a autoremove;_a clean'; a vi='vim -p'; 
pause(){ read -rsp $'Press enter to continue... '$1$'\n\n';}; freeport(){ fuser -k $1/tcp;}; jkill(){ kill $(pidof $1);}; jhash(){ shasum -a 256 <(echo $1)|awk '{print $1}';}; jsocat(){ socat -d -d -lf ~/socat.log tcp4-listen:$2,bind=$1,reuseaddr,fork tcp4:$3:$4&:;}; jinlets(){ inlets client --url wss://$1.herokuapp.com --token $(jhash $2) --upstream $3&:;cc;}; log(){ y=$(echo $@ | sed "s/ /_/g;s/\//%/g");eval $@ |& tee log_$y; tss log_$y;}; ts(){ for x in $@;do mv $x "$(date +"%Y%m%d_%H%M%S")"_$x;done;}; tss(){ for x in $@;do mv $x ${x}_"$(date +"%Y%m%d_%H%M%S")";done;}; jfind(){ find ${2:-'.'} -name "$1" 2>/dev/null;}; jfindw(){ find . -type f -name "${2:-*}" -exec grep -q $1 {} \; -exec ls -al {} \+;}; jfindvi(){ vi $(jfind $1 $2);}; jfindwvi(){ vi $(jfindw $1 $2 | awk '{print $9}');}; jfinddel(){ find ${2:-'.'} -name "$1" 2>/dev/null -exec sudo rm {} \;;}; LL(){ if [[ $1 == '.' ]]; then eval echo $(pushd)|awk '{print $1}'; return; fi; pushd $1>/dev/null;ll;}; te(){ for i in $@;do tar -jpcf $i.tbz2 $i;done;}; td(){ for i in $@;do tar -jpxvf $i;done;}; 
a jgu='echo -e "[user]\nemail=jamessheen@users.noreply.github.com\nname=j\n[alias]\nst=status">~/.gitconfig;git add .;git commit -am "update";git diff --name-only $(git rev-parse --abbrev-ref HEAD) origin/$(git rev-parse --abbrev-ref HEAD);pause;git push'; a gitrmc='git rm -r --cached'; a gitgc='git gc --prune=all'; 
gitclone(){ git clone $(curl -sL -o /dev/null -w %{url_effective} $1);}; gitx(){ if [[ $1 == '' ]]; then git ls-files -v|grep ^h; elif [[ $1 == '.' && $2 == '.' ]]; then git update-index --no-assume-unchanged $(git ls-files); elif [[ $1 == '.' ]]; then git update-index --assume-unchanged $(git ls-files); elif [[ $2 == '.' ]]; then git update-index --no-assume-unchanged $1; else git update-index --assume-unchanged $1; fi;}; 
a jdi='docker images'; a jdp='docker ps -a'; a jdocins='docker inspect'; a jdocnet='docker network'; a jdocsta='docker stats --no-stream'; a jdocipk3s='jdocip k3d-k3s-default-server-0'; a jdocexe='docker exec -it'; a jdocrmv='docker volume rm $(docker volume ls -qf dangling=true)'; a jdocrma='docker ps -a;pause;docker rm -f $(docker ps -aq);jdocrmv'; a jdocu='jdrr ubuntu:18.04; docker commit js js72/js; docker login -u js72; docker push js72/js; jdi'; 
jdr(){ docker run -it -v $(realpath $PWD):/root $@;}; jde(){ docker exec -it $@ bash;}; jdocip(){ docker inspect --format="{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}" $1;}; jdrr(){ if [[ $(which docker) == "" ]];then sudo apt-get update;sudo apt-get install -y docker.io;sudo chmod 666 /var/run/docker.sock;fi;jdr -v /var/run/docker.sock:/var/run/docker.sock --name js --network host ${1:-js72/js};}; 
a jk3dc='k3d cluster'; a jk3dcc='jk3dc create'; a jk3dcd='jk3dc delete'; a jk3dcl='jk3dc list'; a jk3dn='k3d node'; a jk3dnc='jk3dn create'; a jk3dnd='jk3dn delete'; a jk3dnl='jk3dn list'; 
jk3d(){ jk3dcc -a ${1:-2} --k3s-server-arg --no-deploy --k3s-server-arg traefik;kubectl create ns js;}; 
a jkub='kubectl'; a jkubget='jkub get'; a jkubg='echo -e "===\n";jkub get svc,nodes,pod -A -o wide'; a jkubdes='jkub describe'; a jkubeve='jkub get events'; a jkubdel='jkub delete'; a jkubdelnam='jkubdel namespace'; a jkubevenam='jkubeve --namespace'; a jkubns='jkub config view | grep namespace'; a jkubgetdep='jkub get deployments -A -o wide'; a jkubdelall='echo "$(jkubns)";pause;jkubdel deployments,service,pod --all;jkubdelnam $(jkubns | sed "s/namespace: //g")'; a jkubcre='jkub create'; a jkubcredep='jkubcre deployment'; a jkubreg='jkubcre ns js;jkubcredep registry --image=registry:latest --port=5000 -n js;kubectl expose deployment registry -n js --type=LoadBalancer --port=5000 --target-port=5000;jsocat localhost 5000 $(jdocipk3s) 5000'; a jkubgeteve='jkubget events'; a jkubgetpvc='jkub get pvc -A'; a jkubgetnam='jkubget namespace'; 
jkubnns(){ kubectl config set-context --current --namespace $1;jkubns;}; jkubproxy(){ if [[ $1 == '.' ]]; then kubectl proxy -p 8080&:; else curl http://localhost:8080/$1; fi;}; 

